<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Characterizing arithmetic length generalization performance in large language models | Ashish Rai </title> <meta name="author" content="Ashish Rai"> <meta name="description" content="An initial exploration of a mechanistic understanding of arithmetic performance (and performance scaling) in large language models."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A7%A0&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://raishish.github.io/blog/2025/characterizing-arithmetic-length-generalization/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Characterizing arithmetic length generalization performance in large language models",
            "description": "An initial exploration of a mechanistic understanding of arithmetic performance (and performance scaling) in large language models.",
            "published": "February 03, 2025",
            "authors": [
              
              {
                "author": "Ashish Rai",
                "authorURL": "https://raishish.github.io",
                "affiliations": [
                  {
                    "name": "New York University",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Ashish</span> Rai </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">resumé </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Characterizing arithmetic length generalization performance in large language models</h1> <p>An initial exploration of a mechanistic understanding of arithmetic performance (and performance scaling) in large language models.</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#summary">Summary</a> </div> <ul> <li> <a href="#research-approach">Research Approach</a> </li> <li> <a href="#key-discoveries">Key Discoveries</a> </li> <li> <a href="#implications-and-future-directions">Implications and Future Directions</a> </li> </ul> <div> <a href="#abstract">Abstract</a> </div> <div> <a href="#introduction">Introduction</a> </div> <div> <a href="#related-work">Related Work</a> </div> <div> <a href="#approach">Approach</a> </div> <div> <a href="#experiments">Experiments</a> </div> <div> <a href="#results">Results</a> </div> <div> <a href="#discussions-future-work">Discussions &amp; Future Work</a> </div> </nav> </d-contents> <p>The full PDF report (with additional results) is available at this <a href="https://github.com/raishish/arithmetic-interp/blob/main/length-generalization-of-arithmetic-performance.pdf" rel="external nofollow noopener" target="_blank">link</a>.</p> <h2 id="summary">Summary</h2> <h3 id="team">Team</h3> <p>Team members: Ashish Rai, <a href="https://www.linkedin.com/in/akashpeddaputha/" rel="external nofollow noopener" target="_blank">Akash Peddaputha</a>, <a href="https://www.linkedin.com/in/the-aman-gupta/" rel="external nofollow noopener" target="_blank">Aman Gupta</a></p> <p>Advised by: <a href="https://hhexiy.github.io/" rel="external nofollow noopener" target="_blank">Professor He He</a> (as part of the NLP graduate level course at NYU, <a href="https://nyu-cs2590.github.io/fall2024/" rel="external nofollow noopener" target="_blank">Fall 2024</a>)</p> <p>Full report (with additional results): <a href="https://github.com/raishish/arithmetic-interp/blob/main/length-generalization-of-arithmetic-performance.pdf" rel="external nofollow noopener" target="_blank">link</a>.</p> <h3 id="research-approach">Research Approach</h3> <p>We designed a two-pronged approach to investigate this phenomenon:</p> <ol> <li> <p><strong>Standard Benchmark Testing</strong>: We first evaluated model performance by perturbing numerical values for questions in the GSM-8K dataset, a standard mathematical reasoning benchmark containing grade-school-level problems.</p> </li> <li> <p><strong>Custom Dataset Creation</strong>: We then developed our own Arithmetic Length Generalization Dataset (ALGD) with 3,500 examples specifically designed to test scaling behavior across different operations:</p> <ul> <li>Addition</li> <li>Multiplication</li> <li>Subtraction</li> <li>Division</li> <li>Modulus</li> </ul> </li> </ol> <p>For each operation, we created 100 examples with progressively more complex numbers, ranging from 1-digit to 7-digit values, allowing us to precisely identify where performance drops.</p> <h3 id="key-discoveries">Key Discoveries</h3> <h4 id="baseline-performance">Baseline Performance</h4> <p>Our initial evaluation confirmed that frontier models perform impressively on standard mathematical reasoning tasks. Both GPT-4o-mini and LLaMa-3.1-70B-Instruct achieved approximately 94% accuracy on the unmodified GSM-8K dataset. This established a strong baseline for our subsequent experiments.</p> <h4 id="length-generalization-patterns">Length Generalization Patterns</h4> <p>When we increased numerical complexity, we observed fascinating patterns:</p> <ol> <li> <p><strong>Simple Scaling Works Well</strong>: When we multiplied values in GSM-8K problems by constants (like 1000), model performance remained strong. For example, models handled “48” and “480000” with similar accuracy.</p> </li> <li> <p><strong>Unique Digits Matter More Than Size</strong>: The critical factor affecting performance wasn’t merely the size of numbers but their complexity in terms of unique digits. Models struggled significantly with smaller numbers containing more diverse digits (like “48346”) compared to larger but simpler numbers.</p> </li> <li> <strong>Operation-Specific Thresholds</strong>: We identified clear performance thresholds for different operations: <ul> <li> <strong>Addition</strong>: Models generally maintained accuracy up to 6-digit numbers</li> <li> <strong>Multiplication</strong>: Performance declined sharply after 3-digit numbers, reaching 0% for larger values</li> </ul> </li> <li> <strong>Edge Digits vs. Middle Digits</strong>: One particularly interesting finding was that models tended to get the first and last few digits correct even when overall accuracy declined. The middle digits showed consistently higher error rates.</li> </ol> <h4 id="mechanistic-insights">Mechanistic Insights</h4> <p>Using interpretability techniques like Tuned Lens (built upon Logit Lens), we examined how responses are generated at different layers of the network. Our analysis revealed:</p> <ol> <li>The final numerical answers are primarily generated in the later layers of the model</li> <li>Even when providing the first token of multi-token answers in the prompt, models frequently failed to generate subsequent tokens correctly.</li> </ol> <h3 id="implications-and-future-directions">Implications and Future Directions</h3> <p>Our findings highlight important limitations in current LLMs’ arithmetic capabilities. While these models excel at numerous language tasks and can handle basic calculations, they demonstrate clear boundaries in their ability to process complex numerical operations.</p> <p>As researchers, we’re now focused on:</p> <ol> <li> <strong>Mechanistic Understanding</strong>: Using white-box experiments to analyze why these limitations occur</li> <li> <strong>Intermediate Decoding</strong>: Examining model outputs at different stages to identify where errors emerge</li> <li> <strong>Component Analysis</strong>: Identifying specific architectural elements that influence arithmetic performance</li> </ol> <p>Our goal isn’t necessarily to improve arithmetic operations in LLMs (specialized tools already exist for this purpose) but rather to understand how numerical complexity affects model behavior and reasoning.</p> <h2 id="abstract">Abstract</h2> <p>Large language models (LLMs) excel at single-pass NLP tasks like text generation, but struggle with unbounded multistep computations like arithmetic operations with large numbers. This study aims to assess and formulate the length generalization of arithmetic reasoning of LLMs. We observed a significant degradation in model performance when the questions were rephrased with the numerical values scaled in length when tested on the GSM-8K benchmark. We further investigated the scaling behavior on arithmetic tasks and found that state-of-the-art models like GPT-4o-mini and LLaMa-3.1-70B can generate accurate outputs for 4-digit addition and 3-digit multiplication. However, accuracy declines sharply with larger numbers, particularly when the number of unique digits increases. Our results show that while models can generally handle the addition of numbers containing 6 digits and multiplication of 3-digit numbers, they often fail for higher orders. Despite errors on higher-order numbers, we observe a pattern in digit-wise accuracy: the first and the last few digits have higher accuracy than those in the middle, highlighting specific numerical limits in LLM’s capabilities for arithmetic tasks. The dataset is uploaded to <a href="https://huggingface.co/datasets/raishish/ALGD" rel="external nofollow noopener" target="_blank">Hugging Face</a> and the code for reproduction are publicly available at <a href="https://github.com/raishish/arithmetic-interp" rel="external nofollow noopener" target="_blank">https://github.com/raishish/arithmetic-interp</a>.</p> <h2 id="introduction">Introduction</h2> <p>Large Language Models (LLMs) have shown remarkable prowess in various domains, such as natural language processing, question answering, and creative tasks <d-cite key="gunter2024appleintelligencefoundationlanguage,Mirzadeh2024,openai2024gpt4technicalreport"></d-cite>. Nevertheless, they still face challenges when it comes to arithmetic operations. Solving math problems necessitates a combination of skills, including text comprehension and arithmetic calculation <d-cite key="opedal2024languagemodelsexhibitcognitive"></d-cite>. Research indicates that the reasoning process employed by LLMs is often based on probabilistic pattern-matching rather than formal logical reasoning <d-cite key="Mirzadeh2024,jiang2024peektokenbiaslarge"></d-cite>.</p> <p>Recent studies on Transformers indicate that models specifically trained on addition and other arithmetic tasks encounter difficulties in generalizing to varying lengths and complexities of numbers <d-cite key="lee2023teachingarithmeticsmalltransformers"></d-cite>. Even when fine-tuned from pre-trained LLMs, these models continue to struggle with fundamental algorithmic tasks, highlighting the disparity in their capacity to effectively handle numeric complexity <d-cite key="dziri2023faithfatelimitstransformers"></d-cite>.</p> <p>LLMs excel in text generation and summarization, but upon closer examination their limitations in mathematical reasoning capabilities become apparent. In this project, we systematically investigate the arithmetic reasoning of LLMs by examining their generalization performance on elementary arithmetic tasks. We modify numerical values in the GSM-8K benchmark <d-cite key="cobbe2021training"></d-cite> to assess the sensitivity of models like GPT-4o-mini and LLaMa-3.1-70b-Instruct to increasing numerical complexity. Additionally, we explore the scaling behavior of LLMs on these tasks by gradually increasing the complexity of numerical values, testing their accuracy on elementary arithmeric operations from 1-digit to 7-digit numbers. Our experiments show that LLMs can handle simpler arithmetic tasks but their accuracy deteriorates with increasing complexity, especially for smaller numbers with higher unique digit counts.</p> <p>Through this study, we aim to understand the impact of numerical complexity and arithmetic operations on the scaling behavior of LLMs, rather than improving arithmetic operations.</p> <h2 id="related-work">Related Work</h2> <p>Recent advances in LLMs have spurred interest in improving their mathematical reasoning capabilities. <d-cite key="Mirzadeh2024"></d-cite> introduces GSM-Symbolic, an improved benchmark to evaluate LLMs on math reasoning tasks. Their approach reveals the fragility of LLM reasoning, with model performance sensitive to slight numerical changes. <d-cite key="Zhang2024"></d-cite> further explores LLM reasoning mechanisms by identifying critical attention heads and MLPs essential for arithmetic calculations.</p> <p>The work in <d-cite key="Zhou2024"></d-cite> addresses scaling behavior of LLMs across numeral systems, comparing base-10 and base-100 tokenization schemes. <d-cite key="Ahn2024"></d-cite> provides a survey on LLMs in mathematical reasoning, categorizing problem types and identifying relevant datasets for arithmetic, geometry, and theorem proving. Finally, the work by <d-cite key="Zhou2024_Algorithms"></d-cite> investigates transformers’ length generalization capabilities. It focuses on transformer architectural aspects that affect their generalization on length-variable tasks.</p> <p>Our approach builds on these works by analyzing the effects of symbolic reasoning templates and tokenization schemes on mathematical problem-solving accuracy, providing an extended evaluation across larger datasets.</p> <h2 id="approach">Approach</h2> <p>We evaluated the model’s performance on the GSM-8K dataset by multiplying numerical values by multiples of 10, which did not increase the complexity much since the number of unique digits remains constant. The model consistently produced correct answers for such questions. To further increase complexity, we introduced random numbers with more unique digits and tested the model’s handling of these variations. We also used one-shot and few-shot and Chain of Thought (CoT) prompting to improve multi-step reasoning. The models were prompted to not use or generate code to generate responses, thus avoiding the impact of code interpreting techniques. We experimented with different sampling settings and conducted repeated tests under similar conditions to ensure consistency.</p> <p>To mechanistically understand how responses are generated for arithmetic operations, we use transformer interpretability techniques to look for attribution of intermediate layers of the network to the final response.</p> <h2 id="experiments">Experiments</h2> <h3 id="data">Data</h3> <p>In this work, we evaluate our models using two datasets: the widely-used GSM-8K test dataset and a custom dataset we created for evaluating length generalization of arithmetic performance. For both datasets, the task involves generating an accurate numerical output in response to the arithmetic input or question.</p> <h4 id="gsm-8k-dataset">GSM-8K Dataset</h4> <p>For evaluating our models’ mathematical reasoning capabilities, we use the GSM-8K dataset <d-cite key="cobbe2021training"></d-cite>. GSM-8K contains grade-school-level math problems designed to assess logical reasoning and arithmetic capabilities in large language models (LLMs).</p> <h4 id="arithmetic-length-generalization-dataset-algd">Arithmetic Length Generalization Dataset (ALGD)</h4> <p>To evaluate our model’s performance on elementary arithmetic operations, we designed a custom dataset with 3,500 examples for addition, multiplication, subtraction, division, and modulus. Each operation includes 100 examples with 1-digit to 7-digit numbers (~around 700 per operation), allowing us to assess the model’s capacity to handle progressively more complex scenarios.</p> <h3 id="evaluation-methodology">Evaluation methodology</h3> <p>We assess the model’s arithmetic reasoning using accuracy metric on the GSM-8K and ALGD datasets. For GSM-8K, accuracy measures the percentage of correctly answered questions, benchmarking general mathematical reasoning and comparing with prior work. On ALGD, we measure digit-wise accuracy separately across digit complexities for all operations, evaluating the model’s scalability and robustness with numerical complexity along with overall accuracy. This comprehensive approach highlights the model’s strengths and limitations in diverse mathematical tasks.</p> <h3 id="experiment-details">Experiment details</h3> <p>We use the configurations defined in <a href="#tab-model-config">Table 1</a> to evaluate GPT-4o-mini, Llama-3.1-70b-Instruct, Llama-3.1-8b-Instruct, and gemma-2b-it on both GSM-8K and ALGD datasets. We explicitly specify in the system prompt to not use any code to avoid GPT-4o-mini from using its Code Interpreter feature. The exact prompt for different models is shown below. We first compare the performance of both models on GSM-8K to establish a baseline. Inspired by GSM-Symbolic <d-cite key="Mirzadeh2024"></d-cite>, we then increased the number of digits to increase the complexity of the questions and to move away from the training distribution. Finally, we evaluate the models on our generated ALGD dataset. We use Tuned Lens <d-cite key="belrose2023eliciting"></d-cite>, built upon the Logit Lens <d-cite key="nostalgebraist_2022"></d-cite> approach, to project the activations from intermediate layers of Llama-3.1-8B-Instruct into the model’s vocabulary space. Tuned Lens helps avoid misalignment observed in Logit Lens due to evolution of representations by learning layer-specific probes to minimize the distribution shift.</p> <div id="tab-model-config"> <strong>Table 1:</strong> Model configuration parameters used in experiments. </div> <table> <thead> <tr> <th>Parameter</th> <th>Description</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">max_completion_tokens</code></td> <td>Max # of completion tks including output and reasoning tks</td> <td>512</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">temperature</code></td> <td>Sampling temperature</td> <td>0.7</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">top_p</code></td> <td>Probability mass to sample tokens from</td> <td>0.9</td> </tr> <tr> <td>$n$</td> <td># of sequences generated</td> <td>1</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">seed</code></td> <td>Seed for random number generator</td> <td>0</td> </tr> </tbody> </table> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># GPT-4o-mini prompt
</span><span class="n">messages</span> <span class="o">=</span><span class="p">[</span>
  <span class="p">{</span>
    <span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">system</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">You are a helpful assistant. Do not use or generate code in your responses. Please respond with only the final answer, formatted as a single number without additional explanation or context.</span><span class="sh">"</span><span class="p">},</span>
  <span class="p">{</span>
    <span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s"> </span><span class="se">\n\n</span><span class="s">Please provide only the final answer as a single number.</span><span class="sh">"</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Prompt for Llama and Gemma models
</span><span class="n">messages</span> <span class="o">=</span><span class="p">[</span>
  <span class="p">{</span>
    <span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">system</span><span class="sh">"</span> <span class="p">,</span>
    <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">You are a helpful assistant. Do not use or generate code in your responses . Also append the final numerical answer on a new line append with </span><span class="sh">'</span><span class="s">#### </span><span class="sh">'"</span> <span class="p">}</span> <span class="p">,</span>
  <span class="p">{</span>
    <span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="sh">"</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div> <h2 id="results">Results</h2> <p>It can be seen from <a href="#gsm-8k-eval">Fig. 1</a> that frontier models perform with $\sim$94% accuracy on the GSM-8K dataset. However, when the number of digits in the numerical values are increased, our observations reveal that models perform well with numbers containing fewer unique digits, such as 480000, but their accuracy declines with numbers that have more unique digits, even on a small scale (e.g., 48346) (Refer Appendix 6.2.3 in the report). Additionally, the models often misrepresent high-magnitude numbers, sometimes interpreting quadrillions as billions or using inconsistent scientific notation. As numeric complexity increases, models occasionally “hallucinate” numbers, particularly in responses to simple arithmetic prompts involving large sums. When using Few-Shot prompting, models show an over-fitting tendency to the set number of reasoning steps, producing accurate intermediate calculations but failing to combine these results correctly in the final answer. With Chain-of-Thought prompting, while models can decompose the operation between large numbers into those with smaller numbers and generate accurate results, they struggle with summing these intermediate results accurately.</p> <figure id="gsm-8k-eval"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/GSM-8K%20Performance.png" alt="Performance of SoTA models on GSM-8K"> <figcaption> Figure 1: Frontier models like GPT-4o-mini and Llama-3.1-70b-Instruct score &gt;90% on mathematical reasoning datasets like GSM-8K. *Due to the constraint max_completion_tokens set to 512, 6 out of 1319 responses by GPT-4o-mini were truncated. Accuracy is calculated after removing these question-answer pairs. </figcaption> </figure> <figure id="fig-addition"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/addition-length-generalization.png" alt="Addition Length Generalization Performance"> <figcaption>Figure 2a: Performance deteriorates with increase in number of digits. Llama-3.1-70b-Instruct performs better than GPT-4o-mini whose performance drops after 5-digit addition.</figcaption> </figure> <figure id="fig-multiplication"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/multiplication-length-generalization-performance.png" alt="Multiplication Length Generalization Performance"> <figcaption>Figure 2b: Performance of both Llama-3.1-70b-Instruct and GPT-4o-mini reaches 0% after 3-digit multiplication.</figcaption> </figure> <p>We observe performance of addition <a href="#fig-addition">Fig. 2a</a> and multiplication <a href="#fig-multiplication">Fig. 2b</a> limiting to 6-digit and 3-digit numbers, respectively, but exhibit significant errors beyond these limits. Furthermore, our results show that while models can generally handle computations involving numbers up to 6 digits, they often fail for higher orders, with larger unique digits in smaller numbers exacerbating error rates. One interesting observation is that, the models often generate the first and last few digits accurately, even as overall accuracy declines (<a href="#digit-match-gpt-mul">Fig. 3a</a>, <a href="#digit-match-llama-mul">Fig. 3b</a>) . This could be related to frequencies of combination of specific digits in the training corpus or specific tokenization methods. More graphs can be seen in Appendix sections 6.3 and 6.4 in the report. We plan to explore further in this direction. The trend remains the same irrespective of different training recipes and tokenization strategies across the two models.</p> <figure> <div> <div id="digit-match-gpt-mul"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/digit_match_accuracy_gpt_mul.png" alt="GPT-4o-mini 7-digit matches"> <figcaption>Figure 3a: GPT-4o-mini digit accuracy.</figcaption> </div> <div id="digit-match-llama-mul"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/digit_match_accuracy_llama-70b_mul.png" alt="Llama-3.1-70b 7-digit matches"> <figcaption>Figure 3b: Llama-3.1-70b digit accuracy.</figcaption> </div> </div> <br> <figcaption>Figure 3: Digit accuracy for multiplication. The trend remains the same irrespective of different training recipes and tokenization strategies across the two models.</figcaption> </figure> <p>With tuned lens, it can be seen that the final numerical answer is generated in the later layers of Llama-3.1-8B <a href="#3-digit-tuned_lens_success">Fig 4a</a>. In case of multi-token answers, even after providing the first token in the prompt, the model fails to generate the next token <a href="#3-digit-tuned_lens_fail">Fig 4b</a>.</p> <figure> <div> <div id="3-digit-tuned_lens_success"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/348%20+%20456.png" alt="GPT-4o-mini 7-digit matches"> <figcaption>Figure 4a: Correct Response: TunedLens for Llama-3.1-8b-Instruct for 3-digit addition.</figcaption> </div> <div id="3-digit-tuned_lens_fail"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/466%20+%20488.png" alt="Llama-3.1-70b 7-digit matches"> <figcaption>Figure 4b: Incorrect Response: TunedLens for Llama-3.1-8b-Instruct for 3-digit addition.</figcaption> </div> </div> <br> <figcaption>Figure 4: Tuned Lens Plots for Llama-3.1-8b-Instruct (Cross Entropy Loss).</figcaption> </figure> <h3 id="more-multi-digit-multiplication-accuracy-graphs">More Multi-digit Multiplication Accuracy Graphs</h3> <figure id="fig-mul-acc-llama3.1-8b"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/digit_match_accuracy_llama_8b_mul.png" alt="Multiplication Length Generalization Performance"> <figcaption>Multiplication Performance of Llama-3.1-8b-Instruct</figcaption> </figure> <figure id="fig-mul-acc-gemma2-2b"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/digit_match_accuracy_gemma_2b_mul.png" alt="Multiplication Length Generalization Performance"> <figcaption>Multiplication Performance of Gemma-2-2b-Instruct</figcaption> </figure> <h3 id="multi-digit-addition-accuracy-graphs">Multi-digit Addition Accuracy Graphs</h3> <figure id="fig-add-acc-gpt-4o-mini"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/digit_match_accuracy_gpt_add.png" alt="Addition Length Generalization Performance"> <figcaption>Addition Performance of GPT-4o-mini</figcaption> </figure> <figure id="fig-add-acc-llama3.1-70b"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/digit_match_accuracy_add_llama-70b.png" alt="Addition Length Generalization Performance"> <figcaption>Addition Performance of Llama-3.1-70b-Instruct</figcaption> </figure> <figure id="fig-add-acc-llama3.1-8b"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/digit_match_accuracy_llama-8-add.png" alt="Addition Length Generalization Performance"> <figcaption>Addition Performance of Llama-3.1-8b-Instruct</figcaption> </figure> <figure id="fig-add-acc-gemma2-2b"> <img src="/assets/img/2025-02-03-characterizing-arithmetic-length-generalization/digit_match_accuracy_gemma_add.png" alt="Addition Length Generalization Performance"> <figcaption>Addition Performance of Gemma-2-2b-Instruct</figcaption> </figure> <h2 id="conclusion">Conclusion</h2> <p>This research provides valuable insights into the current capabilities and limitations of LLMs in mathematical reasoning. While models like GPT-4o-mini and LLaMa-3.1-70B demonstrate impressive performance on standard benchmarks, they struggle with unbounded multistep computations involving complex numbers.</p> <p>Understanding these limitations is crucial as we continue developing and deploying these models in real-world applications where mathematical reasoning may be required. Our findings contribute to the broader conversation about how to enhance and complement LLM capabilities in domains requiring precise numerical computation.</p> <p>For those interested in exploring this further, our dataset and code are publicly available at our GitHub repository: <a href="https://github.com/raishish/arithmetic-interp" rel="external nofollow noopener" target="_blank">https://github.com/raishish/arithmetic-interp</a>.</p> <h2 id="citation">Citation</h2> <p>If you would like to cite this work, please use the following BibTeX entry:</p> <div class="language-bibtex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">@article</span><span class="p">{</span><span class="nl">rai2024arithmetic-perf-length-generalization</span><span class="p">,</span>
  <span class="na">title</span><span class="p">=</span><span class="s">{How do large language models perform arithmetic operations?}</span><span class="p">,</span>
  <span class="na">author</span><span class="p">=</span><span class="s">{Rai, Ashish and Peddaputha, Akash and Gupta, Aman}</span><span class="p">,</span>
  <span class="na">year</span><span class="p">=</span><span class="s">{2024}</span><span class="p">,</span>
  <span class="na">month</span><span class="p">=</span><span class="s">{Dec}</span><span class="p">,</span>
  <span class="na">url</span><span class="p">=</span><span class="s">{https://raishish.github.io/2024/12/02/llm-arithmetic-interp.html}</span>
<span class="p">}</span>
</code></pre></div></div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2025-02-03-characterizing-arithmetic-length-generalization.bib"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Ashish Rai. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> </body> </html>